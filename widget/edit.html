<!-- Copyright start
  MIT License
  Copyright (c) 2023 Fortinet Inc
  Copyright end -->
<form data-ng-submit="save()" class="noMargin" name="editWidgetForm" data-ng-class="{'state-wait': processing }"
  novalidate>
  <div class="modal-header">
    <h3 class="modal-title col-md-9" data-ng-bind="::header"></h3>
    <button type="button" class="close" data-ng-click="cancel()" data-dismiss="modal" aria-label="Close"
      id="close-edit-widget-form-btn">
      <div aria-hidden="true" class="version-button">+</div>
    </button>
  </div>
  <div class="modal-body">
    <div>
      <div class="form-group"
        data-ng-class="{ 'has-error': editWidgetForm.title.$invalid && editWidgetForm.title.$touched }">
        <label for="title" class="control-label">Title<span class="text-danger">*</span></label>
        <input id="title" name="title" type="text" class="form-control" data-ng-model="config.title" required>
        <div data-cs-messages="editWidgetForm.title">
        </div>
      </div>
    </div>
    <div class="form-group"
      data-ng-class="{ 'has-error': editWidgetForm.resource.$invalid && editWidgetForm.resource.$touched }"
      data-ng-if="modules">
      <label for="resource" class="control-label">Resource<span class="text-danger">*</span></label>
      <select name="resource" id="resource" class="form-control"
        data-ng-options="module.type as module.name for module in modules" data-ng-model="config.resource" required
        data-ng-change="fetchAttributes('target')">
        <option value="">Select an Option</option>
      </select>
      <div data-cs-messages="editWidgetForm.resource"></div>
    </div>
    <div class="form-group" data-ng-if="config.resource">
      <label for="resource" class="control-label">Filter Criteria</label>
      <div data-cs-conditional data-mode="'queryFilters'" data-enable-nested-filter="enableNestedFilter"
        data-fields="params.fields" data-ng-model="config.filters" data-form-name="'editWidgetForm'"
        data-parent-form="editWidgetForm" data-reset-field="params.fields"></div>
    </div>
    <div class="form-group"
      data-ng-class="{ 'has-error': editWidgetForm.sourceNodesField.$invalid && editWidgetForm.sourceNodesField.$touched }"
      data-ng-if="config.resource && params.sourceNodeFields">
      <label for="sourceNodesField" class="control-label">Source Nodes<span class="text-danger">*</span></label>
      <select name="sourceNodesField" id="sourceNodesField" class="form-control"
        data-ng-options="field.name as field.title for field in params.sourceNodeFields"
        data-ng-model="config.sourceNodesField" required>
        <option value="">Select an Field</option>
      </select>
      <div data-cs-messages="editWidgetForm.sourceNodesField"></div>
    </div>
    <div class="form-group"
      data-ng-class="{ 'has-error': editWidgetForm.targetNodesField.$invalid && editWidgetForm.targetNodesField.$touched }"
      data-ng-if="config.resource && params.targetNodePicklistFields">
      <label for="targetNodesField" class="control-label">Target Nodes<span class="text-danger">*</span></label>
      <select name="targetNodesField" id="targetNodesField" class="form-control"
        data-ng-options="field.name as field.title for field in params.targetNodePicklistFields"
        data-ng-model="config.targetNodesField" required>
        <option value="">Select an Picklist</option>
      </select>
      <div data-cs-messages="editWidgetForm.targetNodesField"></div>
    </div>
    <div class="form-group"
      data-ng-class="{ 'has-error': editWidgetForm.relation.$invalid && editWidgetForm.relation.$touched }"
      data-ng-if="config.resource && params.targetRelationshipFields">
      <label for="relation" class="control-label">Relationship Resource<span class="text-danger">*</span></label>
      <select name="relation" id="relation" class="form-control"
        data-ng-options="field.name as field.title for field in params.targetRelationshipFields"
        data-ng-model="config.relation" required data-ng-change="fetchAttributes('relation')">
        <option value="">Select an Option</option>
      </select>
      <div data-cs-messages="editWidgetForm.relation"></div>
    </div>
    <div class="form-group"
      data-ng-class="{ 'has-error': editWidgetForm.relationshipNodesField.$invalid && editWidgetForm.relationshipNodesField.$touched }"
      data-ng-if="config.relation && params.relationNodePicklistFields">
      <label for="relationshipNodesField" class="control-label">Relationship Nodes<span
          class="text-danger">*</span></label>
      <select name="relationshipNodesField" id="relationshipNodesField" class="form-control"
        data-ng-options="field.name as field.title for field in params.relationNodePicklistFields"
        data-ng-model="config.relationshipNodesField" required>
        <option value="">Select an Picklist</option>
      </select>
      <div data-cs-messages="editWidgetForm.relationshipNodesField"></div>
    </div>
    <div class="form-group"
      data-ng-class="{ 'has-error': editWidgetForm.sourceJson.$invalid && editWidgetForm.sourceJson.$touched }">
      <label for="sourceJson" class="control-label">External Source JSON<span class="text-danger">*</span></label>
      <div id="sourceJson" data-cs-json-editor data-options="jsoneditorOptions" data-on-change="setSourceJson"
        data-json="config.sourceJson" class="jinja-json-editor"></div>
      <div data-cs-messages="editWidgetForm.sourceJson"></div>
    </div>
  </div>
  <div class="modal-footer">
    <button id="edit-widget-save" type="submit" class="btn btn-sm btn-primary"><i
        class="icon icon-check margin-right-sm"></i>Save</button>
    <button id="edit-widget-cancel" type="button" class="btn btn-sm btn-default" data-ng-click="cancel()"><i
        class="icon icon-close margin-right-sm"></i>Close</button>
  </div>
</form>